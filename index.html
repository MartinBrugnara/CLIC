<!DOCTYPE html>
<html>
<head>
    <!--
    CLIC what if?
    Esplora i metodi di aggiudicazione dell'offerta economicamente piu' vantaggiosa
    Copyright (C) 2018 Martin Brugnara - Università degli Studi di Trento

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.
    -->


    <meta charset="UTF-8">
    <title>CLIC: What if?</title>

    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="node_modules/\@fortawesome/fontawesome-free-webfonts/css/fontawesome.css">
    <link rel="stylesheet" href="node_modules/\@fortawesome/fontawesome-free-webfonts/css/fa-regular.css">
    <link rel="stylesheet" href="node_modules/\@fortawesome/fontawesome-free-webfonts/css/fa-solid.css">
    <link rel="stylesheet" href="static/css/index.css">
</head>
<body class="pb-5 hide">

    <nav class="navbar navbar-dark bg-dark mb-4" id="app_status">
        <!-- Navbar content -->
        <a class="navbar-brand" href="#">CLIC</a>
        <span class="navbar-text text-white"><strong>Bando:</strong> {{ rpath }}</span>
        <div class="nav-item active flex-column">
            <div><span v-bind:class="{invisible: !read_only}" style="width:100%" class="badge badge-danger">Sola lettura</span></div>
            <div><span v-bind:class="{invisible: !modified}" style="width:100%" class="badge badge-warning">Modificato</span></div>
        </div>
    </nav>

    <div id="errors" class="container alert alert-danger" v-if="errors.length">
        <h4 class="alert-heading">Errori</h4>
        <ul>
            <li v-for="e in errors">{{ e }}</li>
        </ul>
    </div>

    <div id="structure" class="container">
        <h3>Offerta Economica</h3>
        <div class="container mb-2">
            <div class="form-row">
                <div class="form-group col-auto">
                    <label for="mod_economica" class="font-weight-bold">Modalit&agrave;</label>
                    <div class="form-check">
                        <input style="margin-top:0.05rem" class="form-check-input" type="radio" id="ribasso" value="ribasso" v-model="bando.mod_economica">
                        <label class="form-check-label" for="ribasso">Ribasso</label>
                    </div>
                    <div class="form-check">
                        <input style="margin-top:0.05rem" class="form-check-input" type="radio" id="prezzo" value="prezzo" v-model="bando.mod_economica">
                        <label class="form-check-label" for="prezzo">Prezzo</label>
                    </div>
                </div>

                <div class="form-group col-auto no-expand">
                    <label class="font-weight-bold">Peso</label>
                    <h3><span v-bind:class="['badge', 'mb-0', {'badge-light': economic_weight === 30}, {'badge-danger': economic_weight < 0}, {'badge-warning': economic_weight !== 30 && economic_weight >= 0 }]">{{ economic_weight | prec_up_1 }}</span></h3>
                </div>

                <div class="form-group col-auto" v-if="bando.mod_economica == 'prezzo'">
                    <label for="eco_base_asta" class="font-weight-bold">Base d'asta</label>
                    <input type="number" class="form-control" name="base_asta" id="base_asta"
                        min="0.01" step="0.01" v-model.number="bando.base_asta"
                        v-bind:required="base_required">
                    <!-- <small id="eco_base_asta_help" class="form-text text-muted">Decimale positivo con due cifre</small> -->
                </div>

                <div class="form-group col-auto">
                    <label for="eco_func" class="font-weight-bold">Formula</label>
                    <!--class="custom-select"-->
                    <select
                        class="form-control"
                        id="eco_func"
                        v-model="bando.funzione_economica">
                        <template v-for="f in funcs_lst" :key="f.fname">
                            <option v-if="f.o[eco_mode] !== undefined" v-bind:value="f.fname">{{ f.fname  | undash | capitalize }}</option>
                        </template>
                    </select>
                </div>

                <div class="form-group col-auto" v-if="eco_got_param">
                    <label class="font-weight-bold">Parametri</label>
                    <div class="input-group">
                        <template
                            class="input-group"
                            v-for="(p, pname) in funcs[bando.funzione_economica][eco_mode].params">

                            <div class="input-group-prepend">
                                <span class="input-group-text">{{ pname | csub | undash }}</span>
                            </div>

                            <input
                                type="number"
                                v-bind:min=     "funcs[bando.funzione_economica][eco_mode].params[pname].domain.start"
                                v-bind:max=     "funcs[bando.funzione_economica][eco_mode].params[pname].domain.end"
                                v-bind:step=    "funcs[bando.funzione_economica][eco_mode].params[pname].domain.step"
                                v-bind:required="funcs[bando.funzione_economica][eco_mode].params[pname].required"
                                v-bind:name="pname"
                                class="form-control no-expand"
                                v-model.number="bando.parametri_economica[pname]"
                            />
                        </template>
                    </div>
                </div>
            </div>
        </div>


        <h3>Offerta Tecnica</h3>

        <form class="form-inline mb-2">
            <label class="form-check-label font-weight-bold">Riparametrizzazione:</label>
            <div class="form-check ml-2">
                <input type="checkbox" class="form-check-input" id="rep1" v-model="bando.riparametrizzazione1">
                <label class="form-check-label" for="rep1">1&deg; livello ([sub]criteri).</label>
            </div>
            <div class="form-check ml-2">
                <input type="checkbox" class="form-check-input" id="rep2" v-model="bando.riparametrizzazione2">
                <label class="form-check-label" for="rep2">2&deg; livello (parte economica/tecnica).</label>
            </div>
        </form>

        <ul id="ctree" class="nols">
            <criterion
                v-for="(model, index) in bando.criteri"
                v-bind:index="index"
                v-bind:model="model"
                v-bind:name="index+1"
                v-bind:depth="1"></criterion>

            <span>
                <i @click="add_root_criterion" class="fas fa-plus action"></i>
                <label class="nextCid">({{ bando.criteri.length + 1 }})</label>
            </span>
        </ul>
    </div>

<script type="text/x-template" id="tpl_criterion">
<li>
    <div class="d-flex flex-wrap">
        <form class="form-inline flex-shrink-0 mb-2">
            <div class="mr-3">
                <label v-bind:style="{'min-width': padding, 'display': 'inline-flex'}" class="my-1 mr-1">{{name}}</label>

                <a role="button" data-toggle="popover" data-placement="right">
                    <i class="fas fa-info action ml-1"></i>
                </a>
                <div class="popper-content hide">
                    <input type="text" class="form-control form-control-sm text-monospace" placeholder="Nome del criterio"
                        v-bind:size="amax([amin([78, (model.nome||'').trim().length + 3]), 18])"
                        v-model.trim="model.nome" />
                </div>

                <a role="button" data-toggle="popover" data-placement="right" v-bind:style="{'visibility': is_leaf ? 'inherit' : 'hidden' }">
                    <div class="ico8 action">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="2 10 44 28" xml:space="preserve">
                            <g>
                                <path class="" d="M21.2,34.7c-0.1,0-0.1,0-0.2,0c-1.3-0.1-2.5-0.8-3.2-2L9.1,18.4l-4.4,1.5l-1.3-3.8l4.5-1.5   c1.8-0.6,3.8,0.2,4.7,1.8l8.6,14.2l2.3-2.8c1.1-1.3,2.9-1.8,4.4-1.2l2.9,1c0,0,0,0,0.1,0l4.3-10c0.5-1.2,1.5-2,2.7-2.3   c1.1-0.3,2.3-0.1,3.2,0.5l4,2.7l-2.2,3.3l-3.9-2.6l-4.3,10.1c-0.8,1.8-3,2.8-4.9,2.2l-3.1-1l-2.3,2.7   C23.5,34.1,22.4,34.7,21.2,34.7z M38.8,19.1C38.8,19.1,38.8,19.1,38.8,19.1L38.8,19.1z"></path>
                                <path v-bind:class="{'active': model.soglia > 0}" d="M3,23h42v2H3V23z"></path>
                            </g>
                        </svg>
                    </div>
                </a>
                <div class="popper-content hide">
                    <div class="form-check-inline">
                        <input style="margin-top:0.05rem" class="form-check-input"
                        type="radio" v-bind:id="name + '_threshold_points'" value="punti"
                        v-model="model.mod_soglia">
                        <label class="form-check-label" v-bind:for="name + '_threshold_points'">Punti</label>
                    </div>
                    <div class="form-check-inline">
                        <input style="margin-top:0.05rem" class="form-check-input"
                            type="radio" v-bind:id="name + '_threshold_raw'" value="valore"
                            v-model="model.mod_soglia">
                        <label class="form-check-label" v-bind:for="name + '_threshold_raw'">Valore</label>
                    </div>

                    <input type="number" min="0" step="0.01" class="form-control form-control-sm "
                        v-bind:max="model.mod_soglia === 'punti' ? 1 : ''"
                        v-model.number="model.soglia" />
                </div>


                <i @click="sub()" v-bind:style="{'visibility': is_leaf ? 'inherit' : 'hidden' }" class="fas fa-sitemap action ml-1"></i>
                <i @click="remove()" class="far fa-trash-alt action"></i>
            </div>

            <div class="input-group" v-if="isWeightEditable">
                <div class="input-group-prepend">
                    <span class="input-group-text">&#931;</span>
                </div>
                <input type="number" class="form-control"
                    min="0" max="100" step="0.1" required
                    v-model.number="model.peso" />
            </div>
            <h4 v-else><span class="badge badge-light">{{ weight | prec_up_1 }}</span></h4>
            <!-- Alternative for weight -->
            <!-- <input class="form-control" type="text" placeholder="Readonly input here…" readonly> -->



            <div class="input-group ml-2" v-if="is_leaf">
                <select class="custom-select no-expand"
                        v-model="model.tipo" @change="function_change">
                    <option value="Q">Quantitativo</option>
                    <option value="D">Discreto</option>
                    <option value="T">Tabellare</option>
                </select>

                <select class="custom-select" v-if="model.tipo === 'Q'"
                        v-model="model.funzione" @change="function_change">
                    <template v-for="f in funcs_lst" :key="f.fname">
                        <option v-if="f.o['up'] !== undefined" v-bind:value="f.fname">{{ f.fname | undash | capitalize }}</option>
                    </template>
                </select>

                <div v-if="model.tipo == 'T'" class="input-group-append">
                    <span class="input-group-text">
                        <i @click="add_voce" class="fas fa-plus action"></i>
                    </span>
                </div>
            </div>
        </form>

        <div class="form-inline ml-auto align-items-end flex-shrink-0 flex-wrap mw-100 justify-content-start">
            <div class="input-group ml-2 mb-2" v-if="is_leaf && model.tipo === 'Q'">
                <template v-for="(p, pname) in funcs[model.funzione].up.params">
                    <div class="input-group-prepend">
                        <span class="input-group-text">{{ pname | csub | undash }}</span>
                    </div>

                    <input
                        type="number"
                        v-bind:min="funcs[model.funzione].up.params[pname].domain.start"
                        v-bind:max="funcs[model.funzione].up.params[pname].domain.end"
                        v-bind:step="funcs[model.funzione].up.params[pname].domain.step"
                        v-bind:required="funcs[model.funzione].up.params[pname].required"
                        v-bind:name="pname"
                        class="form-control no-expand"
                        v-model.number="model.parametri[pname]" />
                </template>
            </div>

            <template v-if="is_leaf">
                <div class="input-group ml-2 mb-2"
                        v-if="model.tipo == 'T'"
                        v-for="(v, vi) in model.voci">
                    <div class="input-group-prepend">
                        <span class="input-group-text text-monospace" style="white-space:pre">{{ vi + 1 | npadded(model.voci.length)}}</span>
                    </div>
                    <input type="number" class="form-control form-control-sm"
                        min="0" max="100" step="0.1" required
                        v-model.number="model.voci[vi]">
                    <div class="input-group-append">
                        <span class="input-group-text">
                            <i @click="remove_voce(vi)" class="far fa-trash-alt action"></i>
                        </span>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- Recursively enumerate subcriteria -->
    <ul v-if="!is_leaf">
        <criterion
            v-for="(model, index) in model.subcriteri"
            v-bind:model="model"
            v-bind:name="name + '.' + (index + 1)"
            v-bind:depth="depth + 1">
        </criterion>
        <span>
            <i @click="add()" class="fas fa-plus action"></i>
            <label class="next-cid">({{ name + '.' + (model.subcriteri.length + 1) }})</label>
        </span>
    </ul>
</li>
</script>


    <div id="simulation">
        <div id="data-container">
            <div class="container d-flex">
                <div class="flex-fill text-left">
                    <h3>Dati</h3>
                </div>
                <div class="d-flex align-items-end text-right mb-2">
                    <div>
                        <div class="text-right">
                            <strong>Nomi</strong>
                            <div class="form-check-inline ml-2">
                                <input style="margin-top:0.05rem" class="form-check-input"
                                type="radio" id="show" value="show"
                                v-model="env_name_show">

                                <label class="form-check-label" for="show">Mostra</label>
                            </div>
                            <div class="form-check-inline mr-0">
                                <input style="margin-top:0.05rem" class="form-check-input"
                                type="radio" id="hide" value="hide"
                                v-model="env_name_show">
                                <label class="form-check-label" for="hide">Nascondi</label>
                            </div>
                        </div>

                        <div class="text-right">
                            <strong>Modalit&agrave;</strong>
                            <div class="form-check-inline ml-2">
                                <input style="margin-top:0.05rem" class="form-check-input" type="radio" id="points" value="points" v-model="env_data_mode">
                                <label class="form-check-label" for="points">Punti</label>
                            </div>
                            <div class="form-check-inline">
                                <input style="margin-top:0.05rem" class="form-check-input" type="radio" id="raw" value="raw" v-model="env_data_mode">
                                <label class="form-check-label" for="raw">Dati</label>
                            </div>
                            <div class="form-check-inline mr-0">
                                <input style="margin-top:0.05rem" class="form-check-input" type="radio" id="edit" value="edit" v-model="env_data_mode">
                                <label class="form-check-label" for="edit">Modifica</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="text-center">
                <table id="data" class="table table-striped text-right mt-2 pb-2 tbl">
                    <thead>
                        <tr class="names" v-if="enable_names">
                            <th></th>
                            <th><small>ECONOMICA</small></th>
                            <th v-for="c in fst_lvl_names" v-bind:colspan="c.size"><small>{{ c.nome.trim() }}</small></th>
                            <th></th>
                        </tr>
                        <tr class="env_names">
                            <th><span>#</span></th>
                            <th><span v-if="!enable_names">Economica</span><span v-else>0</span></th>

                            <th scope="col" v-for="c in cols" v-bind:colspan="c.tipo == 'T' && env_data_mode != 'points' ? c.voci.length : 1">
                                <a data-toggle="popover" data-placement="bottom"
                                    data-trigger="hover" v-bind:data-force_status="env_name_show"><span v-bind:title="c.nome">{{c.env_name}}</span></a>
                                <div class="popper-content hide">
                                    {{ c.nome || 'Non specificato' }}
                                    <!-- Alternative to allow edit
                                    <input type="text" class="mono" placeholder="Nome del criterio" v-model.trim="c.nome"
                                        v-bind:size="amax([amin([78, (c.nome||'').trim().length + 3]), 18])">
                                    -->
                                </div>
                            </th>
                            <th scope="col">
                                <i class="fas fa-exclamation"></i>
                            </th>
                        </tr>
                        <tr class="weights">
                            <th><small>Peso</small></th>
                            <th>
                                <small>{{ economic_weight }}</small>
                            </th>

                            <template v-for="(c, ci) in cols">
                                <template v-if="c.tipo == 'T'">
                                    <th v-if="env_data_mode == 'points'"><small>{{ weights[ci] }}</small></th>
                                    <th v-else v-for="(v, vi) in c.voci">
                                        <input v-if="env_data_mode == 'edit'" v-model.number="c.voci[vi]" type="number" min="0" max="100" step="0.1" required>
                                        <small v-else>{{ c.voci[vi] }}</small>
                                    </th>
                                </template>
                                <template v-else>
                                    <th>
                                        <input v-if="env_data_mode == 'edit'" v-model.number="c.peso" type="number" min="0" max="100" step="0.1" required>
                                        <small v-else>{{ c.peso }}</small>
                                    </th>
                                </template>
                            </template>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody v-bind:class="{'text-center': env_data_mode === 'edit', edit: env_data_mode === 'edit'}">
                        <tr v-for="(o, i) in bando.offerte" :key="o.nome" v-bind:class="{excluded: points[i].excluded}">
                            <template v-if="env_data_mode == 'edit'">
                                <td class="text-left"><input type="text" v-model.tirm.lazy="o.nome" required></td>
                                <td><input type="number" min="0.01" step="0.01" v-model.number="o.economica" required></td>
                                <template v-for="(t, ti) in o.tecnica">
                                    <template v-if="cols[ti].tipo == 'T'">
                                        <td v-for="(v, vi) in cols[ti].voci" v-bind:class="['text-center', {issue: points[i].excluded_for[ti]}]">
                                            <input type="checkbox" v-model="t[vi]">
                                        </td>
                                    </template>
                                    <template v-else-if="cols[ti].tipo == 'D'">
                                        <td v-bind:class="{issue: points[i].excluded_for[ti]}"><input type="number" min="0" step="0.01" max="1" required v-model.number="o.tecnica[ti]"></td>
                                    </template>
                                    <template v-else>
                                        <td v-bind:class="{issue: points[i].excluded_for[ti]}"><input type="number" min="0" step="0.01" required v-model.number="o.tecnica[ti]"></td>
                                    </template>
                                </template>
                                <td class="text-center">
                                    <i @click="clone(i)" class="far fa-copy action"></i>
                                    <i @click="remove(i)" class="far fa-trash-alt action"></i>
                                </td>
                            </template>

                            <template v-else>
                                <td class="text-left">{{ o.nome }}</td>
                                <td v-if="env_data_mode == 'points'">{{ points[i].economica * economic_weight | precn(2)}}</td>
                                <td v-else>{{o.economica | precn(2)}}</td>
                                <template v-for="(t, ti) in o.tecnica">
                                    <template v-if="cols[ti].tipo == 'T'">
                                        <td v-if="env_data_mode == 'points'" v-bind:class="{issue: points[i].excluded_for[ti]}">
                                            {{ points[i].tecnica[ti] * weights[ti] | precn(2) }}
                                        </td>
                                        <td v-else v-for="(v, vi) in cols[ti].voci" v-bind:class="['text-center', {issue: points[i].excluded_for[ti]}]">
                                            <span v-if="t[vi]">&#x2714;</span>
                                            <span v-else>&#x2718;</span>
                                        </td>
                                    </template>
                                    <template v-else-if="env_data_mode == 'points'">
                                        <td v-bind:class="{issue: points[i].excluded_for[ti]}">{{ points[i].tecnica[ti] * cols[ti].peso | precn(2) }}</td>
                                    </template>
                                    <template v-else>
                                        <td v-bind:class="{issue: points[i].excluded_for[ti]}">{{ t | precn(2) }}</td>
                                    </template>
                                </template>
                                <td class="text-center">
                                    <i @click="clone(i)" class="far fa-copy action"></i>
                                    <i @click="remove(i)" class="far fa-trash-alt action"></i>
                                </td>
                            </template>
                        </tr>
                    </tbody>
                    <caption class="text-center">
                        <i @click="add" class="fas fa-plus action"></i>
                    </caption>
                </table>
            </div>
        </div>

        <div class="container mt-4">
            <div class="row">
                <div class="col-md" id="lab">
                    <h3 class="text-center">Lab</h3>

                    <form class="mb-2" v-if="criteria.length || !env_show_eco">
                        <div class="form-row">
                            <label class="col-sm-2 col-form-label"><strong>Criterio</strong></label>
                            <div class="col-sm-10 input-group">
                                <select class="custom-select" v-model="env_new_criteria">
                                    <option v-if="!env_show_eco" value="-1">Economica</option>
                                    <option v-for="(c, i) in criteria" v-bind:key="c.env_name" v-bind:value="i">{{ c.env_name }}</option>
                                </select>
                                <div class="input-group-append">
                                    <label class="input-group-text" for="">
                                        <i @click="manage" class="fas fa-plus action"></i>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </form>

                    <ul id="lab_lst">
                        <li v-if="env_show_eco" class="mb-2">
                            <div class="d-flex flex-wrap">
                                <form class="form-inline mb-2 flex-shrink-0">
                                    <div class="mr-3">
                                        <label style="{'display': 'inline-flex'}" class="my-1 mr-1">Economica</label>

                                        <a @click="done(-1)" class="ml-auto">
                                            <i class="fas fa-check action ml-1"></i>
                                        </a>
                                    </div>
                                </form>

                                <form class="form-inline mb-2 flex-grow-1">
                                    <div class="input-group">
                                        <select
                                            class="custom-select"
                                            id="eco_func"
                                            v-model="bando.funzione_economica">
                                            <template v-for="f in funcs_lst" :key="f.fname">
                                                <option v-if="f.o[eco_mode] !== undefined" v-bind:value="f.fname">{{ f.fname  | undash | capitalize }}</option>
                                            </template>
                                        </select>
                                    </div>
                                </form>

                                <div class="form-inline align-items-start flex-shrink-0 flex-wrap mw-100 justify-content-start">

                                    <template
                                        class="input-group"
                                        v-for="(p, pname) in funcs[bando.funzione_economica][eco_mode].params">

                                        <div class="input-group mr-2 mb-2">

                                            <div class="input-group-prepend">
                                                <span class="input-group-text">{{ pname | csub | undash }}</span>
                                            </div>

                                            <input
                                                type="number"
                                                v-bind:min=     "funcs[bando.funzione_economica][eco_mode].params[pname].domain.start"
                                                v-bind:max=     "funcs[bando.funzione_economica][eco_mode].params[pname].domain.end"
                                                v-bind:step=    "funcs[bando.funzione_economica][eco_mode].params[pname].domain.step"
                                                v-bind:required="funcs[bando.funzione_economica][eco_mode].params[pname].required"
                                                v-bind:name="pname"
                                                class="form-control no-expand"
                                                v-model.number="bando.parametri_economica[pname]"
                                            />
                                        </div>
                                    </template>

                                    <div class="input-group mr-2 mb-2" v-if="funcs[bando.funzione_economica][eco_mode].base_asta">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">Base d'asta</span>
                                        </div>

                                        <input
                                            type="number" min="0.01" step="0.01" required
                                            class="form-control no-expand"
                                            v-model.number="bando.base_asta"
                                        />
                                    </div>
                                </div>
                            </div>
                        </li>



                        <li v-for="(model, i) in env_selected_criteria" class="mb-2">
                            <div class="d-flex flex-wrap">
                                <form class="form-inline mb-2 flex-shrink-0">
                                    <div class="mr-3">
                                        <label v-bind:style="{'min-width': padding, 'display': 'inline-flex'}" class="my-1 mr-1">{{model.env_name}}</label>

                                        <a role="button" data-toggle="popover" data-placement="right">
                                            <i class="fas fa-info action ml-1"></i>
                                        </a>
                                        <div class="popper-content hide">
                                            <input type="text" class="form-control form-control-sm text-monospace" placeholder="Nome del criterio"
                                                v-bind:size="amax([amin([78, (model.nome||'').trim().length + 3]), 18])"
                                                v-model.trim="model.nome" />
                                        </div>

                                        <a role="button" data-toggle="popover" data-placement="right">
                                            <div class="ico8 action">
                                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="2 10 44 28" xml:space="preserve">
                                                    <g>
                                                        <path class="" d="M21.2,34.7c-0.1,0-0.1,0-0.2,0c-1.3-0.1-2.5-0.8-3.2-2L9.1,18.4l-4.4,1.5l-1.3-3.8l4.5-1.5   c1.8-0.6,3.8,0.2,4.7,1.8l8.6,14.2l2.3-2.8c1.1-1.3,2.9-1.8,4.4-1.2l2.9,1c0,0,0,0,0.1,0l4.3-10c0.5-1.2,1.5-2,2.7-2.3   c1.1-0.3,2.3-0.1,3.2,0.5l4,2.7l-2.2,3.3l-3.9-2.6l-4.3,10.1c-0.8,1.8-3,2.8-4.9,2.2l-3.1-1l-2.3,2.7   C23.5,34.1,22.4,34.7,21.2,34.7z M38.8,19.1C38.8,19.1,38.8,19.1,38.8,19.1L38.8,19.1z"></path>
                                                        <path v-bind:class="{'active': model.soglia > 0}" d="M3,23h42v2H3V23z"></path>
                                                    </g>
                                                </svg>
                                            </div>
                                        </a>
                                        <div class="popper-content hide">
                                            <div class="form-check-inline">
                                                <input style="margin-top:0.05rem" class="form-check-input"
                                                type="radio" v-bind:id="name + '_threshold_points'" value="punti"
                                                v-model="model.mod_soglia">
                                                <label class="form-check-label" v-bind:for="name + '_threshold_points'">Punti</label>
                                            </div>
                                            <div class="form-check-inline">
                                                <input style="margin-top:0.05rem" class="form-check-input"
                                                    type="radio" v-bind:id="name + '_threshold_raw'" value="valore"
                                                    v-model="model.mod_soglia">
                                                <label class="form-check-label" v-bind:for="name + '_threshold_raw'">Valore</label>
                                            </div>

                                            <input type="number" min="0" step="0.01" class="form-control form-control-sm "
                                                v-bind:max="model.mod_soglia === 'punti' ? 1 : ''"
                                                v-model.number="model.soglia" />
                                        </div>

                                        <a @click="done(i)" class="ml-auto">
                                            <i class="fas fa-check action ml-1"></i>
                                        </a>
                                    </div>

                                    <div class="input-group mr-2">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">&#931;</span>
                                        </div>
                                        <input type="number" class="form-control"
                                            min="0" max="100" step="0.1" required
                                            v-model.number="model.peso" />
                                    </div>
                                </form>

                                <form class="form-inline mb-2 flex-grow-1">
                                    <div class="input-group">
                                        <select class="custom-select" v-if="model.tipo === 'Q'"
                                                v-model="model.funzione" @change="function_change(i)">
                                            <template v-for="f in funcs_lst" :key="f.fname">
                                                <option v-if="f.o['up'] !== undefined" v-bind:value="f.fname">{{ f.fname | undash | capitalize }}</option>
                                            </template>
                                        </select>
                                    </div>
                                </form>

                                <div class="form-inline align-items-start flex-shrink-0 flex-wrap mw-100 justify-content-start">
                                    <template v-for="(p, pname) in funcs[model.funzione].up.params">
                                        <div class="input-group mr-2 mb-2">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">{{ pname | csub | undash }}</span>
                                            </div>

                                            <input
                                                type="number"
                                                v-bind:min="funcs[model.funzione].up.params[pname].domain.start"
                                                v-bind:max="funcs[model.funzione].up.params[pname].domain.end"
                                                v-bind:step="funcs[model.funzione].up.params[pname].domain.step"
                                                v-bind:required="funcs[model.funzione].up.params[pname].required"
                                                v-bind:name="pname"
                                                class="form-control no-expand"
                                                v-model.number="model.parametri[pname]" />
                                        </div>
                                    </template>
                               </div>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="col-md text-center">
                    <h3>Ranking</h3>

                    <table id="rank" class="table table-striped text-right tbl">
                        <thead>
                            <tr>
                                <th>
                                    <span class="x-middle"></span>
                                    <div class="d-inline-flex flex-column ml-2">
                                        <input id="nome_asc" type="radio" v-model="env_data_orderby" value="nome_asc">
                                        <label for="nome_asc" class="mb-0">&#x25B2;</label>
                                        <input id="nome_desc" type="radio" v-model="env_data_orderby" value="nome_desc">
                                        <label for="nome_desc" class="mb-0">&#x25BC;</label>
                                    </div>
                                </th>
                                <th>
                                    <span class="x-middle">Σ</span>
                                    <div class="d-inline-flex flex-column ml-2">
                                        <input id="agg_asc" type="radio" v-model="env_data_orderby" value="agg_asc">
                                        <label for="agg_asc" class="mb-0">&#x25B2;</label>
                                        <input id="agg_desc" type="radio" v-model="env_data_orderby" value="agg_desc">
                                        <label for="agg_desc" class="mb-0">&#x25BC;</label>
                                    </div>
                                </th>
                                <th>
                                    <span class="x-middle">Electre</span>
                                    <div class="d-inline-flex flex-column ml-2">
                                        <input id="electre_asc" type="radio" v-model="env_data_orderby" value="electre_asc">
                                        <label for="electre_asc" class="mb-0">&#x25B2;</label>
                                        <input id="electre_desc" type="radio" v-model="env_data_orderby" value="electre_desc">
                                        <label for="electre_desc" class="mb-0">&#x25BC;</label>
                                    </div>
                                </th>
                                <th>
                                    <span class="x-middle">Topsis</span>
                                    <div class="d-inline-flex flex-column ml-2">
                                        <input id="topsis_asc" type="radio" v-model="env_data_orderby" value="topsis_asc">
                                        <label for="topsis_asc" class="mb-0">&#x25B2;</label>
                                        <input id="topsis_desc" type="radio" v-model="env_data_orderby" value="topsis_desc">
                                        <label for="topsis_desc" class="mb-0">&#x25BC;</label>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody v-if="!fatal_errors">
                            <tr v-for="(o, oi) in scoreboard.rank">
                                <td>{{ o.nome }}</td>
                                <td>{{ o.agg | precn(2) }}</td>
                                <td>{{ o.electre }}</td>
                                <td>{{ o.topsis | precn(2) }}</td>
                            </tr>
                        </tbody>
                        <caption v-if="!fatal_errors && scoreboard.excluded">
                            <label><strong>Escluse:</strong></label> {{ scoreboard.excluded }}.
                        </caption>
                        <caption v-if="fatal_errors">
                            <p class="text-danger">Corregi gli errori per poter calcolare le classifiche.</p>
                        </caption>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script src="node_modules/vue/dist/vue.min.js"></script>
    <script src="static/js/index.js"></script>
</body>
</html>
